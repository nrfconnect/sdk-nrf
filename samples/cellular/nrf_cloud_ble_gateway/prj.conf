#
# Copyright (c) 2024 Nordic Semiconductor ASA
#
# SPDX-License-Identifier: LicenseRef-Nordic-5-Clause
#

# Log level
# For more verbose and detailed log output, set the log level to
# CONFIG_NRFCLOUD_BLE_GATEWAY_LOG_LEVEL_DBG=y instead.
CONFIG_NRFCLOUD_BLE_GATEWAY_LOG_LEVEL_INF=y

# General config
CONFIG_EVENTS=y
CONFIG_PICOLIBC_IO_FLOAT=y
CONFIG_RESET_ON_FATAL_ERROR=y
CONFIG_NCS_SAMPLES_DEFAULTS=y
CONFIG_DK_LIBRARY=y

# LED indication
# Uncomment these to minimize LED state indication when power savings are necessary
# CONFIG_LED_VERBOSE_INDICATION=n
# CONFIG_LED_CONTINUOUS_INDICATION=n

# Or, uncomment this to completely disable LED state indication
# CONFIG_LED_INDICATION_DISABLED=y

# Improved Logging
# CONFIG_LOG_MODE_DEFERRED allows logging from multiple threads simultaneously without creating
# splintered log entries, at the cost of needing a buffer for storing logs.
CONFIG_LOG_MODE_DEFERRED=y

# CONFIG_LOG_BUFFER_SIZE is the aforementioned buffer. A size of 12000 bytes is useful for debugging
# and prototyping, but is probably more than necessary for production-ready firmware.
CONFIG_LOG_BUFFER_SIZE=12000
CONFIG_LOG_SPEED=y
CONFIG_LOG_FUNC_NAME_PREFIX_INF=y
CONFIG_LOG_FUNC_NAME_PREFIX_ERR=y
CONFIG_LOG_PRINTK=y

# Heap and stacks
# Extended AT host/monitor stack/heap sizes since some nrf_cloud credentials are longer than 1024 bytes.
CONFIG_AT_MONITOR_HEAP_SIZE=2048
CONFIG_AT_HOST_STACK_SIZE=2048
# Extended memory heap size needed both for PGPS and for encoding JSON-based nRF Cloud Device Messages.
CONFIG_HEAP_MEM_POOL_SIZE=20480
CONFIG_MAIN_STACK_SIZE=3072
CONFIG_SYSTEM_WORKQUEUE_STACK_SIZE=4096
CONFIG_APPLICATION_WORKQUEUE_STACK_SIZE=4096
# The default modem shared memory buffer for TX is significantly larger than required.
# RX buffer has to be larger because the sample reads certificates so using default value.
CONFIG_NRF_MODEM_LIB_SHMEM_TX_SIZE=4096
CONFIG_HW_STACK_PROTECTION=y
CONFIG_EXTRA_EXCEPTION_INFO=y

# Enable Networking and Connection Manager.
CONFIG_NETWORKING=y
CONFIG_NET_SOCKETS=y
CONFIG_NET_SOCKETS_OFFLOAD=y
CONFIG_NET_MGMT_EVENT_STACK_SIZE=2048
CONFIG_NET_CONNECTION_MANAGER_MONITOR_STACK_SIZE=1024
CONFIG_MAIN_STACK_SIZE=2048

# Enable LTE Connectivity using Connection Manager
CONFIG_NET_IPV4=y
CONFIG_NET_IPV6=y
CONFIG_NET_IPV6_NBR_CACHE=n
CONFIG_NET_IPV6_MLD=n
CONFIG_NET_CONNECTION_MANAGER=y
CONFIG_NRF_MODEM_LIB_NET_IF=y
CONFIG_NRF_MODEM_LIB_NET_IF_AUTO_DOWN=y
CONFIG_NRF_MODEM_LIB_NET_IF_DOWN_DEFAULT_LTE_DISCONNECT=y

# Enable power savings mode
CONFIG_LTE_PSM_REQ=n
# Set the PSM Requested Active Time to 20 seconds
#CONFIG_LTE_PSM_REQ_RAT="00001010"

# Modem library
CONFIG_NRF_MODEM_LIB=y

# AT commands interface
CONFIG_UART_INTERRUPT_DRIVEN=y
CONFIG_AT_HOST_LIBRARY=y

# Wait for credential installation to be complete before connecting to nRF Cloud
CONFIG_NRF_CLOUD_CHECK_CREDENTIALS=y

# nRF Cloud
CONFIG_NRF_CLOUD=y
CONFIG_NRF_CLOUD_MQTT=y # This also enables FOTA by implicitly setting CONFIG_NRF_CLOUD_FOTA=y

# MQTT
CONFIG_MQTT_KEEPALIVE=120

# MCUBOOT - Needed by FOTA
CONFIG_BOOTLOADER_MCUBOOT=y
CONFIG_IMG_MANAGER=y
CONFIG_MCUBOOT_IMG_MANAGER=y
CONFIG_STREAM_FLASH_ERASE=y

# not enough flash to enable these currently:
CONFIG_SECURE_BOOT=n
#CONFIG_BUILD_S1_VARIANT=y
#CONFIG_SPM_SERVICE_S0_ACTIVE=y

# Services configuration
CONFIG_TEMP_TRACKING=n
CONFIG_LOCATION_TRACKING=n
CONFIG_LOCATION=n
CONFIG_LOCATION_METHOD_GNSS=n
CONFIG_LOCATION_METHOD_CELLULAR=n
CONFIG_NRF_CLOUD_AGNSS=n
CONFIG_NRF_CLOUD_LOCATION=n
CONFIG_MODEM_INFO=y
CONFIG_MODEM_INFO_ADD_NETWORK=y
CONFIG_MODEM_INFO_ADD_SIM=y
CONFIG_NRF_CLOUD_PGPS=n
#CONFIG_NRF_CLOUD_PGPS_REPLACEMENT_THRESHOLD=4
#CONFIG_NRF_CLOUD_PGPS_REQUEST_UPON_INIT=y
CONFIG_NRF_CLOUD_MQTT_SHADOW_TRANSFORMS=y

# Date Time lib - Used by PGPS and main application
CONFIG_DATE_TIME=y

# LTE link control - used by PGPS and main application
CONFIG_LTE_LINK_CONTROL=y
CONFIG_LTE_LC_EDRX_MODULE=y
CONFIG_LTE_LC_PSM_MODULE=y

# Settings - used by nRF Cloud library and PGPS
CONFIG_SETTINGS=y
CONFIG_SETTINGS_FCB=y
CONFIG_FCB=y

# Download Client - used by FOTA and PGPS
CONFIG_DOWNLOADER=y
CONFIG_DOWNLOADER_STACK_SIZE=4096
CONFIG_DOWNLOADER_MAX_HOSTNAME_SIZE=128

# Flash - Used by FOTA and PGPS
CONFIG_FLASH=y
CONFIG_FLASH_PAGE_LAYOUT=y
CONFIG_FLASH_MAP=y
CONFIG_STREAM_FLASH=y
CONFIG_MPU_ALLOW_FLASH_WRITE=y
CONFIG_NRF_CLOUD_ALERT=n
CONFIG_NRF_CLOUD_LOG_DIRECT=n
CONFIG_NRF_CLOUD_LOG_OUTPUT_LEVEL=3

# On initial connection to the cloud, add info sections to the shadow
CONFIG_NRF_CLOUD_SEND_DEVICE_STATUS=y
CONFIG_NRF_CLOUD_SEND_DEVICE_STATUS_NETWORK=y
CONFIG_NRF_CLOUD_SEND_DEVICE_STATUS_SIM=y
CONFIG_NRF_CLOUD_SEND_SERVICE_INFO_FOTA=y
CONFIG_NRF_CLOUD_SEND_SERVICE_INFO_UI=n

# Instrument the heap
CONFIG_MEM_SLAB_TRACE_MAX_UTILIZATION=y
CONFIG_SYS_HEAP_RUNTIME_STATS=y

CONFIG_GATEWAY_BLE_FOTA=n

# Enable Bluetooth stack and libraries
#DT_HAS_ZEPHYR_BT_HCI_UART_ENABLED && BT_HCI && BT_DRIVERS

CONFIG_BT=y
CONFIG_BT_H4=y
CONFIG_BT_HCI=y
CONFIG_BT_CTLR=n
CONFIG_BT_CENTRAL=y
CONFIG_BT_DRIVERS=y
CONFIG_BT_WAIT_NOP=y
CONFIG_BT_GATT_CLIENT=y
CONFIG_BT_GATT_DM=y
CONFIG_BT_SCAN=y
CONFIG_BT_SCAN_FILTER_ENABLE=y
CONFIG_BT_SCAN_UUID_CNT=1
CONFIG_BT_SCAN_NAME_CNT=0
CONFIG_BT_MAX_CONN=8
CONFIG_BT_BUF_ACL_RX_COUNT_EXTRA=1
CONFIG_BT_GATT_DM_MAX_ATTRS=100
CONFIG_BT_FILTER_ACCEPT_LIST=y
CONFIG_BT_SETTINGS=n
CONFIG_BT_EXT_ADV=y
CONFIG_BT_HCI_VS=y
CONFIG_BT_REMOTE_VERSION=y

#CONFIG_BT_DEBUG_LOG=y
#CONFIG_BT_DEBUG_CONN=y
#CONFIG_BT_DEBUG_GATT=n
#CONFIG_BT_DEBUG_HCI_CORE=y
#CONFIG_BT_DEBUG_HCI_DRIVER=y
CONFIG_BT_LOG_LEVEL_INF=y

CONFIG_BT_HCI_TX_STACK_SIZE=2048
CONFIG_BT_HCI_TX_STACK_SIZE_WITH_PROMPT=y
CONFIG_BT_RX_STACK_SIZE=2048

# Gateway
CONFIG_NRF_CLOUD_GATEWAY=y
CONFIG_FLASH_TEST=n
CONFIG_AT_CMD_REQUESTS=n

# for customer builds, set below to n
CONFIG_GATEWAY_DBG_CMDS=y

# to enable AT command handling unfettered by the shell, turn the below
# option on, and CONFIG_GATEWAY_SHELL off (ignore warnings about the symbols
# in the block below that, or comment them out)
CONFIG_AT_HOST_LIBRARY=n
CONFIG_GATEWAY_SHELL=y

# set various buffer sizes in shell
CONFIG_SHELL_STACK_SIZE=6144
CONFIG_SHELL_CMD_BUFF_SIZE=3072
CONFIG_SHELL_PRINTF_BUFF_SIZE=4096
CONFIG_SHELL_BACKEND_SERIAL_API_INTERRUPT_DRIVEN=y
CONFIG_SHELL_BACKEND_SERIAL_RX_RING_BUFFER_SIZE=3072
CONFIG_SHELL_PROMPT_UART="login: "
CONFIG_SHELL_START_OBSCURED=y
CONFIG_SHELL_PROMPT_SECURE="gateway:# "

# turn on for low level BLE commands
CONFIG_BT_SHELL=n

# force these off -- they default on
CONFIG_LOG_CMDS=n
CONFIG_PWM_SHELL=n
CONFIG_BOOT_BANNER=n
CONFIG_FLASH_SHELL=n
CONFIG_DEVICE_SHELL=n
CONFIG_DEVMEM_SHELL=n
#CONFIG_SHELL_CMDS=n
CONFIG_SHELL_WILDCARD=n
CONFIG_SHELL_CMDS_RESIZE=y
CONFIG_CLOCK_CONTROL_NRF_SHELL=n

CONFIG_DEBUG_COREDUMP=n
#CONFIG_DEBUG_COREDUMP_BACKEND_LOGGING=y
#CONFIG_DEBUG_COREDUMP_MEMORY_DUMP_MIN=y

# change logging level when at login prompt
CONFIG_STARTING_LOG_OVERRIDE=y
CONFIG_STARTING_LOG_LEVEL_ERR=y
CONFIG_NRF_CLOUD_LOG_LEVEL_INF=y
CONFIG_NET_LOG=y
CONFIG_MQTT_LOG_LEVEL_INF=y

CONFIG_DEBUG_OPTIMIZATIONS=y
CONFIG_DEBUG_THREAD_INFO=y
CONFIG_THREAD_MONITOR=y
