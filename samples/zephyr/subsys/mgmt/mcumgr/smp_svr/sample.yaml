sample:
  description: Simple Management Protocol sample
  name: smp svr
common:
  sysbuild: true
  harness: console
  harness_config:
    type: multi_line
    ordered: false
    regex:
      - "Starting .*bootloader"
      - "Jumping to the .*image slot"
      - "smp_sample: build time"
      - "smp_bt_sample: Advertising successfully started"
  timeout: 15
  tags:
    - ci_samples_zephyr_subsys_mgmt_mcumgr_smp_svr

tests:
  sample.mcumgr.smp_svr.bt.nrf5340dk.ext_flash:
    sysbuild: true
    extra_args:
      - FILE_SUFFIX=nrf5340_bt
    platform_allow:
      - nrf5340dk/nrf5340/cpuapp
    integration_platforms:
      - nrf5340dk/nrf5340/cpuapp
  sample.mcumgr.smp_svr.bt.nrf54l15:
    tags: bluetooth
    extra_args: EXTRA_CONF_FILE="overlay-bt.conf"
    platform_allow:
      - nrf54l15dk/nrf54l15/cpuapp
      - nrf54l15dk/nrf54l10/cpuapp
    integration_platforms:
      - nrf54l15dk/nrf54l15/cpuapp
      - nrf54l15dk/nrf54l10/cpuapp
  sample.mcumgr.smp_svr.bt.nrf54l15dk.ext_flash:
    extra_args:
      - OVERLAY_CONFIG="overlay-bt.conf"
      - DTC_OVERLAY_FILE="boards/nrf54l15dk_nrf54l15_cpuapp_ext_flash.overlay"
      - mcuboot_CONF_FILE="boards/nrf54l15dk_nrf54l15_cpuapp_ext_flash.conf"
      - mcuboot_EXTRA_DTC_OVERLAY_FILE="boards/nrf54l15dk_nrf54l15_cpuapp_ext_flash.overlay"
      - SB_CONFIG_PM_OVERRIDE_EXTERNAL_DRIVER_CHECK=y
      - SB_CONFIG_PM_EXTERNAL_FLASH_MCUBOOT_SECONDARY=y
    platform_allow:
      - nrf54l15dk/nrf54l15/cpuapp
      - nrf54l15dk/nrf54l10/cpuapp
      - nrf54l15dk/nrf54l05/cpuapp
    integration_platforms:
      - nrf54l15dk/nrf54l15/cpuapp
  sample.mcumgr.smp_svr.bt.nrf54l15dk.ext_flash.pure_dts:
    extra_args:
      - OVERLAY_CONFIG="overlay-bt.conf"
      - DTC_OVERLAY_FILE="boards/nrf54l15dk_nrf54l15_cpuapp_ext_flash.overlay"
      - mcuboot_CONF_FILE="boards/nrf54l15dk_nrf54l15_cpuapp_ext_flash.conf"
      - mcuboot_EXTRA_DTC_OVERLAY_FILE="boards/nrf54l15dk_nrf54l15_cpuapp_ext_flash.overlay"
      - SB_CONFIG_PARTITION_MANAGER=n
    platform_allow:
      - nrf54l15dk/nrf54l15/cpuapp
      - nrf54l15dk/nrf54l10/cpuapp
      - nrf54l15dk/nrf54l05/cpuapp
    integration_platforms:
      - nrf54l15dk/nrf54l15/cpuapp
    harness_config:
      type: multi_line
      ordered: false
      regex:
        - "smp_sample: build time"
        - "smp_bt_sample: Advertising successfully started"
  sample.mcumgr.smp_svr.bt.nrf54h20dk:
    sysbuild: true
    extra_args:
      - EXTRA_CONF_FILE="overlay-bt.conf"
      - SB_CONFIG_NETCORE_IPC_RADIO=y
      - SB_CONFIG_NETCORE_IPC_RADIO_BT_HCI_IPC=y
      - mcuboot_CONFIG_NRF_SECURITY=y
      - mcuboot_CONFIG_MULTITHREADING=y
    platform_allow:
      - nrf54h20dk/nrf54h20/cpuapp
    integration_platforms:
      - nrf54h20dk/nrf54h20/cpuapp
  sample.mcumgr.smp_svr.bt.nrf54h20dk.direct_xip_withrevert:
    sysbuild: true
    extra_args:
      - FILE_SUFFIX="merged_slot"
      - EXTRA_CONF_FILE="overlay-bt.conf"
      - SB_CONFIG_NETCORE_IPC_RADIO=y
      - SB_CONFIG_NETCORE_IPC_RADIO_BT_HCI_IPC=y
      - SB_CONFIG_MCUBOOT_MODE_DIRECT_XIP_WITH_REVERT=y
      - mcuboot_CONFIG_NRF_SECURITY=y
      - mcuboot_CONFIG_MULTITHREADING=y
    platform_allow:
      - nrf54h20dk/nrf54h20/cpuapp
    integration_platforms:
      - nrf54h20dk/nrf54h20/cpuapp
  sample.mcumgr.smp_svr.serial.nrf54h20dk.ecdsa:
    sysbuild: true
    extra_args:
      - EXTRA_CONF_FILE="overlay-serial.conf"
      - SB_CONFIG_BOOT_SIGNATURE_TYPE_ECDSA_P256=y
      - mcuboot_CONFIG_NRF_SECURITY=y
      - mcuboot_CONFIG_MULTITHREADING=y
    platform_allow:
      - nrf54h20dk/nrf54h20/cpuapp
    integration_platforms:
      - nrf54h20dk/nrf54h20/cpuapp
    harness_config:
      type: multi_line
      ordered: true
      regex:
        - "Starting bootloader"
        - "Jumping to the first image slot"
        - "smp_sample: build time"
  sample.mcumgr.smp_svr.bt.nrf54h20dk.direct_xip_withrequests:
    sysbuild: true
    extra_args:
      - FILE_SUFFIX="requests"
      - EXTRA_CONF_FILE="overlay-bt.conf"
      - SB_CONFIG_NETCORE_IPC_RADIO=y
      - SB_CONFIG_NETCORE_IPC_RADIO_BT_HCI_IPC=y
      - SB_CONFIG_MCUBOOT_MODE_DIRECT_XIP_WITH_REVERT=y
      - mcuboot_CONFIG_NRF_SECURITY=y
      - mcuboot_CONFIG_MULTITHREADING=y
    platform_allow:
      - nrf54h20dk/nrf54h20/cpuapp
    integration_platforms:
      - nrf54h20dk/nrf54h20/cpuapp
