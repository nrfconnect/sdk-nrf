#
# Copyright (c) 2023 Nordic Semiconductor
#
# SPDX-License-Identifier: LicenseRef-Nordic-5-Clause
#

menuconfig NRF_PROVISIONING
	bool "nRF Provisioning"
	depends on NRF_MODEM_LIB
	depends on SETTINGS
	depends on MODEM_ATTEST_TOKEN
	imply FCB

if NRF_PROVISIONING

config NRF_PROVISIONING_AUTO_START_ON_INIT
	bool "Start provisioning automatically on initialization"
	help
	  Start the client automatically after the client is initialized in the
	  nrf_provisioning_init() function.

config NRF_PROVISIONING_SCHEDULED
	bool "Scheduled provisioning"
	depends on NRF_PROVISIONING_AUTO_START_ON_INIT
	help
	  Activate scheduled provisioning. The client will try to perform provisioning
	  at a given interval set by CONFIG_NRF_PROVISIONING_INTERVAL_S.

config NRF_PROVISIONING_VALID_DATE_TIME_TIMEOUT_SECONDS
	int "Time to wait for valid date-time in seconds"
	default 60
	help
	  Time to wait for valid date-time before starting provisioning. The provisioning library
	  depends on JWT generation, which requires a valid date-time.

config NRF_PROVISIONING_MODEM_STATE_WAIT_TIMEOUT_SECONDS
	int "Modem state wait timeout in seconds"
	default 120
	help
	  Timeout for waiting for the modem to enter the desired connectivity state.

config NRF_PROVISIONING_INTERVAL_S
	int "Maximum provisioning interval in seconds"
	default 86400

config NRF_PROVISIONING_SPREAD_S
	int "Provisioning time spread in seconds"
	default 0

config NRF_PROVISIONING_SHELL
	bool "Shell utilities"
	depends on SHELL
	help
	  Activate shell module that provides nRF Provisioning commands to the console.

config NRF_PROVISIONING_WITH_CERT
	bool "Include the certificate"
	default y
	help
	  Includes the root certificate used by the server side and provisions it if needed.

config NRF_PROVISIONING_ROOT_CA_SEC_TAG
	int "Root CA for nRF Cloud Identity Service - security tag"
	default 189298

config NRF_PROVISIONING_SAVE_CMD_ID
	bool "Save the latest command id to storage"
	help
	  Saves the latest command id to storage after successful Finished command.

config NRF_PROVISIONING_CUSTOM_AT
	bool "Custom AT commands"
	depends on AT_CMD_CUSTOM
	help
	  Activate custom AT commands.

config NRF_PROVISIONING_SETTINGS_STORAGE_PATH
	string "Settings storage path for provisioning"
	default "provisioning"

config NRF_PROVISIONING_RX_BUF_SZ
	int "RX buffer size"
	default 1024

config NRF_PROVISIONING_TX_BUF_SZ
	int "TX buffer size"
	default 2048

config NRF_PROVISIONING_JWT_SEC_TAG
	int "Provision Service's security tag, private Device Identity key used by default"
	default 0

config NRF_PROVISIONING_JWT_MAX_VALID_TIME_S
	int "Maximum JWT valid lifetime (seconds)"
	range 0 360
	default 300

config NRF_PROVISIONING_PROVIDE_ATTESTATION_TOKEN
	bool "Provide attestation token when unauthorized"
	default y
	help
	  Unauthorized errors occur when the device is not yet claimed on
	  nRF Cloud. Provide attestation in the library callback token when unauthorized.

config NRF_PROVISIONING_STACK_SIZE
	int "nRF Provisioning Stack size"
	default 4096 if NRF_PROVISIONING_LOG_LEVEL_DBG
	default 2048
	help
	  Stack size for the nRF Provisioning thread.

config NRF_PROVISIONING_INITIAL_BACKOFF
	int "Initial backoff time in seconds"
	default 60
	help
	  Initial time for exponential backoff in seconds. The time is doubled
	  after each failed (busy or timeout) attempt to connect to the server.
	  The maximum time is 86400 seconds (24 hours).

rsource "Kconfig.nrf_provisioning_http"

rsource "Kconfig.nrf_provisioning_coap"

module=NRF_PROVISIONING
module-dep=LOG
module-str=Log level for nRF Provisioning
module-help=Enables nRF Provisioning log messages.
source "subsys/logging/Kconfig.template.log_config"

endif
