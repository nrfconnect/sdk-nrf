#
# Copyright (c) 2022 Nordic Semiconductor
#
# SPDX-License-Identifier: LicenseRef-Nordic-5-Clause
#

menuconfig EMDS
	bool "Emergency Data Storage"
	select CRC
	select CRC32_K_4_2_TABLE_256
	depends on PARTITION_MANAGER_ENABLED
	depends on FLASH_MAP
	help
	  Enable Emergency Data Storage subsystem.

if EMDS

config EMDS_SCANNING_FAILURES
	int "Maximum number of scanning failures"
	default 2
	help
	  Maximum number of allowed metadata scanning failures on partition
	  before giving up. The option should be tradeoff between
	  performance and reliability. If the value is too low, the system
	  may not take into account all the candidates, and may not select
	  the best one for recovery. If the value is too high, the system
	  may take too long to scan the partition, and may not be able to
	  recover in time. The value should be set to the number of
	  expected failures during the scanning process.

config EMDS_MAX_CANDIDATES
	int "Maximum number of snapshot candidates"
	default 3
	help
	  Maximum number of snapshot candidates to keep track within
	  the partition to select the best one for recovery.

config EMDS_FLASH_TIME_WRITE_ONE_WORD_US
	int
	default 41 if SOC_NRF52840
	default 43 if SOC_NRF52833
	default 43 if SOC_SERIES_NRF53X
	default 28 if SOC_SERIES_NRF54LX
	help
	  Max time to write one word into non-volatile storage (in microseconds).
	  The word size is 4 bytes. The value is dependent on the
	  chip used, and should be checked against the chip's datasheet.
	  For RRAM-based flash driver the average time to write a 32-bit word
	  in a stream of sequentially address ordered writes was taken.

	  Note that despite the typical time for streamed writing of a 32-bit word
	  for RRAM is 22 microseconds the actual time may vary. It is used a bit bigger
	  value here to compensate dispersion around the typical time.

config EMDS_CHUNK_PREPARATION_TIME_US
	int
	default 31 if SOC_NRF52840
	default 31 if SOC_NRF52833
	default 31 if SOC_SERIES_NRF53X
	default 8 if SOC_SERIES_NRF54LX
	help
	  Time that is required to prepare a chunk for storing.
	  It includes creation chunk from entries, crc calculation and
	  prologue/epilogue time of participated functions.
	  Time is approximate and depends on entry sizes and number of entries.

module = EMDS
module-str = emergency data storage
source "${ZEPHYR_BASE}/subsys/logging/Kconfig.template.log_config"

endif # EMDS
