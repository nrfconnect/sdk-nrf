#
# Copyright (c) 2023 Nordic Semiconductor ASA
#
# SPDX-License-Identifier: LicenseRef-Nordic-5-Clause
#

CONFIG_SLM_NATIVE_TLS=y
# Enable offloading with TLS_NATIVE.
CONFIG_NET_SOCKETS_OFFLOAD_DISPATCHER=y
# Enable legacy crypto support
CONFIG_NRF_SECURITY=y
CONFIG_NORDIC_SECURITY_BACKEND=y
CONFIG_MBEDTLS_PSA_CRYPTO_C=y
# Enable TLS client and server via Mbed TLS library
CONFIG_MBEDTLS=y
CONFIG_MBEDTLS_TLS_LIBRARY=y
CONFIG_MBEDTLS_SSL_SRV_C=y
CONFIG_MBEDTLS_CIPHER=y
# Reserve enough settings space for the certificates
CONFIG_PM_PARTITION_SIZE_SETTINGS_STORAGE=0x4000
# Set maximum TLS contexts.
# Increase also CONFIG_POSIX_MAX_FDS, if you need more TLS contexts.
CONFIG_NET_SOCKETS_TLS_MAX_CONTEXTS=2
CONFIG_POSIX_MAX_FDS=10
# Set packet sizes for incoming and outcoming packets.
# If handshake packet (likely CA chain) or TLS record size exceeds these
# values, increase the corresponding value and the CONFIG_MBEDTLS_HEAP_SIZE.
CONFIG_MBEDTLS_SSL_IN_CONTENT_LEN=4096
CONFIG_MBEDTLS_SSL_OUT_CONTENT_LEN=4096
CONFIG_MBEDTLS_ENABLE_HEAP=y
# Raise to 64000 for two simultaneous TLS connections
CONFIG_MBEDTLS_HEAP_SIZE=36864
# Enable TLS protocol options
CONFIG_NET_SOCKETS_SOCKOPT_TLS=y
CONFIG_NET_SOCKETS_TLS_SET_MAX_FRAGMENT_LENGTH=y
CONFIG_MBEDTLS_SSL_SERVER_NAME_INDICATION=y
# Enable AES
CONFIG_MBEDTLS_AES_C=y
CONFIG_MBEDTLS_CCM_C=y
CONFIG_MBEDTLS_GCM_C=y
CONFIG_MBEDTLS_CIPHER_MODE_CBC=y
CONFIG_MBEDTLS_CIPHER_PADDING_PKCS7=y
# Enable ECC
CONFIG_MBEDTLS_ECP_C=y
CONFIG_PSA_WANT_ECC_SECP_R1_256=y
# Enable ECDSA
CONFIG_MBEDTLS_ECDSA_C=y
CONFIG_PSA_WANT_ALG_ECDSA=y
CONFIG_MBEDTLS_ECDSA_DETERMINISTIC=y
CONFIG_PSA_WANT_ALG_DETERMINISTIC_ECDSA=y
CONFIG_PSA_WANT_KEY_TYPE_ECC_KEY_PAIR=y # dep for DETERMINISTIC_ECDSA
CONFIG_PSA_WANT_ALG_HMAC=y # dep for DETERMINISTIC_ECDSA
# Enable ECDH
CONFIG_MBEDTLS_KEY_EXCHANGE_ECDH_RSA_ENABLED=y
CONFIG_MBEDTLS_ECDH_C=y
CONFIG_PSA_WANT_ALG_ECDH=y
# Enable EDCHE
CONFIG_MBEDTLS_KEY_EXCHANGE_ECDHE_ECDSA_ENABLED=y
CONFIG_MBEDTLS_KEY_EXCHANGE_ECDHE_RSA_ENABLED=y
# Enable RSA
CONFIG_MBEDTLS_RSA_C=y
CONFIG_MBEDTLS_KEY_EXCHANGE_RSA_ENABLED=y
CONFIG_MBEDTLS_PKCS1_V15=y
CONFIG_MBEDTLS_MPI_MAX_SIZE=512
CONFIG_PSA_WANT_KEY_TYPE_RSA_PUBLIC_KEY=y
CONFIG_PSA_WANT_RSA_KEY_SIZE_2048=y
CONFIG_PSA_WANT_RSA_KEY_SIZE_4096=y
# Enable SHA
CONFIG_MBEDTLS_SHA256_C=y
CONFIG_MBEDTLS_SHA512_C=y
# Enable PSK key exchange
CONFIG_MBEDTLS_KEY_EXCHANGE_PSK_ENABLED=y

# Disable MBEDTLS modules
CONFIG_MBEDTLS_CTR_DRBG_C=n
CONFIG_MBEDTLS_CHACHA20_C=n
CONFIG_MBEDTLS_POLY1305_C=n
CONFIG_MBEDTLS_DHM_C=n
CONFIG_MBEDTLS_CMAC_C=n
# Disable cipher modes
CONFIG_MBEDTLS_CIPHER_MODE_CTR=n
CONFIG_MBEDTLS_CIPHER_MODE_CFB=n
CONFIG_MBEDTLS_CIPHER_MODE_OFB=n
# Disable key exchange algorithms
CONFIG_MBEDTLS_KEY_EXCHANGE_DHE_PSK_ENABLED=n
CONFIG_MBEDTLS_KEY_EXCHANGE_DHE_RSA_ENABLED=n
# Disable hash functions
CONFIG_MBEDTLS_SHA1_C=n

# Enable Socket Logging for debug
#CONFIG_NET_LOG=y
#CONFIG_NET_SOCKETS_LOG_LEVEL_DBG=y

# Enable Mbed TLS logs
#CONFIG_MBEDTLS_DEBUG=y
#CONFIG_MBEDTLS_DEBUG_C=y
#CONFIG_MBEDTLS_DEBUG_LEVEL=3
