common:
  sysbuild: true
  depends_on: gpio
  harness: ztest
  harness_config:
    fixture: gpio_loopback
  tags:
    - drivers
    - spim
    - ci_tests_drivers_spi

tests:
  drivers.spim_latency_1Mbps:
    platform_allow: &standard_spi_platforms
      - nrf52840dk/nrf52840
      - nrf5340dk/nrf5340/cpuapp
      - nrf54h20dk/nrf54h20/cpuapp
      - nrf54l15dk/nrf54l15/cpuapp
    integration_platforms:
      - nrf54h20dk/nrf54h20/cpuapp
    extra_args:
      - EXTRA_DTC_OVERLAY_FILE="boards/spi_1MHz.overlay"

  drivers.spim_latency_8Mbps:
    platform_allow: *standard_spi_platforms
    integration_platforms:
      - nrf54h20dk/nrf54h20/cpuapp

  drivers.spim_latency_16Mbps:
    platform_allow:
      - nrf54h20dk/nrf54h20/cpuapp
    integration_platforms:
      - nrf54h20dk/nrf54h20/cpuapp
    extra_args:
      - DTC_OVERLAY_FILE="boards/nrf54h20dk_nrf54h20_cpuapp_fast.overlay"
      - CONFIG_MEASUREMENT_REPEATS=200
      - CONFIG_SPI_NRFX_RAM_BUFFER_SIZE=512
