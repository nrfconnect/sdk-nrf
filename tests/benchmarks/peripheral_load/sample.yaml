sample:
  name: Peripheral stress test

common:
  depends_on:
    - adc
    - gpio
    - i2c
    - spi
    - watchdog
  tags:
    - drivers
    - spi
    - sensors
    - ci_tests_benchmarks_peripheral_load
  harness: console

tests:
  sample.benchmarks.peripheral_stress_test.nrf54h:
    filter: not CONFIG_COVERAGE
    harness_config:
      fixture: pca63566
      type: multi_line
      ordered: false
      regex:
        - ".*Accelerometer thread has completed"
        - ".*ADC thread has completed"
        - ".*BME680 thread has completed"
        - ".*CAN thread has completed"
        - ".*Counter thread has completed"
        - ".*Flash thread has completed"
        - ".*GPIO thread has completed"
        - ".*I2S thread has completed"
        - ".*PWM thread has completed"
        - ".*TEMP thread has completed"
        - ".*Timer thread has completed"
        - ".*WDT thread has completed"
        - ".*CPU load thread has completed"
        - ".*Clock thread has completed"
        - ".*usb_thread: Baudrate 9600"
        - ".*Bluetooth init OK"
        - ".*all \\d{1,} threads have completed"
    extra_args:
      - SHIELD=pca63566
      - SB_CONFIG_NETCORE_IPC_RADIO=y
      - SB_CONFIG_NETCORE_IPC_RADIO_BT_HCI_IPC=y
    platform_allow: nrf54h20dk/nrf54h20/cpuapp
    integration_platforms:
      - nrf54h20dk/nrf54h20/cpuapp

  sample.benchmarks.peripheral_stress_test.nrf54h.pm:
    filter: not CONFIG_COVERAGE
    harness_config:
      fixture: pca63566
      type: multi_line
      ordered: false
      regex:
        - ".*Accelerometer thread has completed"
        - ".*ADC thread has completed"
        - ".*BME680 thread has completed"
        - ".*CAN thread has completed"
        - ".*Counter thread has completed"
        - ".*Flash thread has completed"
        - ".*GPIO thread has completed"
        - ".*I2S thread has completed"
        - ".*PWM thread has completed"
        - ".*TEMP thread has completed"
        - ".*Timer thread has completed"
        - ".*WDT thread has completed"
        - ".*CPU load thread has completed"
        - ".*Clock thread has completed"
        - ".*usb_thread: Baudrate 9600"
        - ".*Bluetooth init OK"
        - ".*all \\d{1,} threads have completed"
    extra_args:
      - SHIELD=pca63566
      - SB_CONFIG_NETCORE_IPC_RADIO=y
      - SB_CONFIG_NETCORE_IPC_RADIO_BT_HCI_IPC=y
      - EXTRA_CONF_FILE=power_management.conf
    platform_allow: nrf54h20dk/nrf54h20/cpuapp
    integration_platforms:
      - nrf54h20dk/nrf54h20/cpuapp

  sample.benchmarks.peripheral_stress_test.nrf54l15:
    filter: not CONFIG_COVERAGE
    harness_config:
      fixture: pca63565
      type: multi_line
      ordered: false
      regex:
        - ".*Accelerometer thread has completed"
        - ".*ADC thread has completed"
        - ".*BME680 thread has completed"
        - ".*Counter thread has completed"
        - ".*Flash thread has completed"
        - ".*GPIO thread has completed"
        - ".*I2S thread has completed"
        - ".*PWM thread has completed"
        - ".*TEMP thread has completed"
        - ".*Timer thread has completed"
        - ".*WDT thread has completed"
        - ".*CPU load thread has completed"
        - ".*Bluetooth init OK"
        - ".*all \\d{1,} threads have completed"
    extra_args:
      - SHIELD=pca63565
      - CONFIG_CAN=n
    platform_allow: nrf54l15dk/nrf54l15/cpuapp
    integration_platforms:
      - nrf54l15dk/nrf54l15/cpuapp

  sample.benchmarks.peripheral_stress_test.nrf54lm20:
    filter: not CONFIG_COVERAGE
    harness_config:
      fixture: pca63565
      type: multi_line
      ordered: false
      regex:
        - ".*Accelerometer thread has completed"
        - ".*ADC thread has completed"
        - ".*BME680 thread has completed"
        - ".*Counter thread has completed"
        - ".*Flash thread has completed"
        - ".*GPIO thread has completed"
        - ".*I2S thread has completed"
        - ".*PWM thread has completed"
        - ".*TEMP thread has completed"
        - ".*Timer thread has completed"
        - ".*WDT thread has completed"
        - ".*CPU load thread has completed"
        - ".*usb_thread: Baudrate 9600"
        - ".*Bluetooth init OK"
        - ".*all \\d{1,} threads have completed"
    extra_args:
      - SHIELD=pca63565
      - CONFIG_CAN=n
    platform_allow:
      - nrf54lm20dk/nrf54lm20a/cpuapp
    integration_platforms:
      - nrf54lm20dk/nrf54lm20a/cpuapp

  sample.benchmarks.peripheral_stress_test.nrf54ls05:
    filter: not CONFIG_COVERAGE
    harness_config:
      type: multi_line
      ordered: false
      regex:
        - ".*ADC thread has completed"
        - ".*Counter thread has completed"
        - ".*GPIO thread has completed"
        - ".*PWM thread has completed"
        - ".*TEMP thread has completed"
        - ".*Timer thread has completed"
        - ".*WDT thread has completed"
        - ".*CPU load thread has completed"
        - ".*all \\d{1,} threads have completed"
    extra_args:
      - CONFIG_CAN=n
      - CONFIG_FLASH=n
      - CONFIG_I2S=n
      - CONFIG_BT=n
    platform_allow:
      - nrf54ls05dk/nrf54ls05b/cpuapp
    integration_platforms:
      - nrf54ls05dk/nrf54ls05b/cpuapp

  sample.benchmarks.peripheral_stress_test.nrf54lv10:
    filter: not CONFIG_COVERAGE
    harness_config:
      type: multi_line
      ordered: false
      regex:
        - ".*ADC thread has completed"
        - ".*Counter thread has completed"
        - ".*GPIO thread has completed"
        - ".*TEMP thread has completed"
        - ".*Timer thread has completed"
        - ".*WDT thread has completed"
        - ".*CPU load thread has completed"
        - ".*Bluetooth init OK"
        - ".*all \\d{1,} threads have completed"
    extra_args:
      - CONFIG_CAN=n
      - CONFIG_FLASH=n
      - CONFIG_I2S=n
      - CONFIG_PWM=n
    platform_allow:
      - nrf54lv10dk/nrf54lv10a/cpuapp
    integration_platforms:
      - nrf54lv10dk/nrf54lv10a/cpuapp
