# Copyright (c) 2022 Nordic Semiconductor ASA
# SPDX-License-Identifier: Apache-2.0

zephyr_library()

# One of NPMX devices have to be selected in Kconfig
if(CONFIG_NPMX_DEVICE_NPM1300_FP1)
    zephyr_compile_definitions(NPM1300_FP1)
    set(NPMX_DEVICE_NAME "npm1300_fp1")
    set(NPMX_BACKEND_TYPE "twim")
else()
    return()
endif()

zephyr_compile_definitions_ifdef(CONFIG_NPMX_LOG_LEVEL_DBG NPMX_DEBUG)

set(SRC_DIR ${ZEPHYR_NPMX_MODULE_DIR}/drivers/src)
set(INC_DIR ${ZEPHYR_NPMX_MODULE_DIR}/drivers/include)

# Get MDK include files
zephyr_include_directories("${ZEPHYR_NPMX_MODULE_DIR}/mdk/${NPMX_DEVICE_NAME}")

# Get backend files
zephyr_include_directories("${ZEPHYR_NPMX_MODULE_DIR}/backends")
zephyr_library_sources("${ZEPHYR_NPMX_MODULE_DIR}/backends/npmx_backend_${NPMX_BACKEND_TYPE}.c")

# Get glue and config files
zephyr_include_directories(.)
zephyr_library_sources(npmx_glue.c)

# Get drivers files
zephyr_include_directories(${INC_DIR})
zephyr_library_sources(${SRC_DIR}/npmx_gpio.c)
zephyr_library_sources(${SRC_DIR}/npmx_core.c)

zephyr_library_sources(npmx_driver.c)
zephyr_library_sources(npmx_trigger.c)

# Get npmx include file
zephyr_include_directories(${ZEPHYR_NPMX_MODULE_DIR})
